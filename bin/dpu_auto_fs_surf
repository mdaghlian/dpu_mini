#!/usr/bin/env python
#$ -j Y
#$ -cwd
#$ -V

import os
opj = os.path.join
import pickle
import sys
import numpy as np
import re
import scipy.io

from dpu_mini.utils import dag_hyphen_parse, dag_arg_checker
from dpu_mini.auto_fs_surf import dag_auto_surf_function

def main(argv):
    '''
    ---------------------------
    Auto open a subject surface

    Args:
        --p_path    path to .pkl/.npy/.gii/.mgz file 
        --sub           subject number
        --fs_dir        freesurfer director
        --output_dir     where to put it
        --file_name     name of the file to dump
    
    '''
    sub = None
    fs_dir = os.environ['SUBJECTS_DIR']
    file_name = 'blah'
    output_dir = opj(os.getcwd())
    hemi_markers = ['lh', 'rh']
    p_path = None
    extra_kwargs = {}
    for i,arg in enumerate(argv):        
        if arg in ('--param_path', '--params_path', '--path', '--p_path'):
            p_path = argv[i+1]
        elif '--sub' in arg:
            sub = dag_hyphen_parse('sub', argv[i+1])
        elif '--fs_dir' in arg:
            fs_dir = argv[i+1]  
        elif '--output_dir' in arg:
            output_dir = argv[i+1]              
        elif '--file_name' in arg:
            file_name = argv[i+1]
        elif '--hemi_markers' in arg:
            hemi_markers = argv[i+1].split(',')  
        elif arg in ('-h', '--help'):
            print(main.__doc__)
            sys.exit()

        elif '--' in arg:
            this_kwarg = arg.replace('--', '')
            this_kwarg_value = dag_arg_checker(argv, i+1)
            extra_kwargs[this_kwarg] = this_kwarg_value
            print(f'Unknown arg: {arg}')
    dag_auto_surf_function(
        p_path=p_path,
        sub=sub,
        fs_dir=fs_dir,
        output_dir=output_dir,
        file_name=file_name,
        hemi_markers=hemi_markers,
        **extra_kwargs
    )


if __name__ == "__main__":
    main(sys.argv[1:])    